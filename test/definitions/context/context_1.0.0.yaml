info:
  version: 1.0.0
  title: context
  x-ibm-name: context
  description: context test suite

basePath: /v1

swagger: '2.0'

consumes:
  - application/xml
  - application/json

produces:
  - application/xml
  - application/json

paths:
  /context:
    get:
      summary: get a context variable value
      parameters:
        - name: name
          in: query
          description: the context name
          type: string
      responses:
        '200':
          description: 200 OK
  /context/internal:
    get:
      summary: get interal context variable value
      operationId: getInternal
      parameters:
        - name: param1
          in: query
          description: parameter 1
          type: string
        - name: param2
          in: header
          description: parameter 2
          type: integer
      responses:
        '200':
          description: 200 OK
  /context/api:
    get:
      summary: get API context variable value
      responses:
        '200':
          description: 200 OK
  /context/request/parameters/{param4}/{param3}:
    parameters:
      - name: param3
        in: path
        description: parameter 3
        type: integer
        required: true
      - name: param4
        in: header
        description: parameter 4
        type: integer
        required: true
    get:
      summary: get request parameter value
      operationId: getParameters
      parameters:
        - name: param1
          in: query
          description: parameter 1
          type: string
          required: true
        - name: param2
          in: query
          description: parameter 2
          type: integer
          required: true
        - name: param4              # overwrite param4 definition
          in: path
          description: parameter 4
          type: string
          required: true
        - name: X-foo
          in: header
          description: X-foo
          type: string
          required: true
        - name: paramBoolean
          in: query
          description: parameter Bool
          type: boolean
          required: true
        - name: X-paramArray
          in: header
          description: parameter Array
          type: array
          items:
            type: integer
            format: int64
          collectionFormat: csv
          required: true
        - name: queryArray
          in: query
          description: parameter Array in query
          type: array
          items:
            type: string
          required: true
      responses:
        '200':
          description: 200 OK

x-ibm-configuration:
  properties:
    foo: default_foo
  catalogs:
    local:
      properties:
        foo: local_foo
  assembly:
    execute:
      - operation-switch:
          title: operation-switch
          case:
            - operations:
                - path: /context
                  verb: get
              execute:
                - javascript:
                    title: write context variable to message.body
                    source: |
                      var name = request.parameters.name;
                      message.body = {
                        name: name,
                        value: get(name)
                      };
                - set-variable:
                    title: set-content-type
                    actions:
                      - set: message.headers.content-type
                        value: application/json
            - operations:
                - getInternal
              execute:
                - set-variable:
                    title: set-variable
                    actions:
                      - set: message.body
                        value: $(_.api)
                - set-variable:
                    title: set-content-type
                    actions:
                      - set: message.headers.content-type
                        value: application/json
            - operations:
                - path: /context/api
                  verb: get
              execute:
                - set-variable:
                    title: set-variable
                    actions:
                      - set: message.body
                        value: $(api)
                - set-variable:
                    title: set-content-type
                    actions:
                      - set: message.headers.content-type
                        value: application/json
            - operations:
                - getParameters
              execute:
                - set-variable:
                    title: set-variable
                    actions:
                      - set: message.body
                        value: $(request.parameters)
                - set-variable:
                    title: set-content-type
                    actions:
                      - set: message.headers.content-type
                        value: application/json
